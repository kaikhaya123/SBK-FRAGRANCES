#!/usr/bin/env node
const fs = require('fs');
const path = require('path');

// Scans public/images and public/videos and writes app/data/perspectiveMedia.js
// Picks up to 3 images and 3 videos (sorted alphabetically) and writes a JS module

const projectRoot = path.resolve(__dirname, '..');
const publicDir = path.join(projectRoot, 'public');
const imagesDir = path.join(publicDir, 'images');
const videosDir = path.join(publicDir, 'videos');
const outFile = path.join(projectRoot, 'app', 'data', 'perspectiveMedia.js');

function listFiles(dir, exts) {
  try {
    return fs.readdirSync(dir)
      .filter(f => exts.includes(path.extname(f).toLowerCase()))
      .map(f => path.join(dir, f))
      .map(p => path.relative(publicDir, p).replace(/\\/g, '/')) // forward slashes
      .sort();
  } catch (e) {
    return [];
  }
}

const imageExts = ['.jpg', '.jpeg', '.png', '.webp', '.avif', '.gif'];
const videoExts = ['.mp4', '.webm', '.mov'];

const images = listFiles(imagesDir, imageExts).slice(0, 3);
const videos = listFiles(videosDir, videoExts).slice(0, 3);

const items = [];
images.forEach((p, i) => items.push({ type: 'image', src: `/${p}`, alt: `Image ${i + 1}` }));
videos.forEach((p, i) => items.push({ type: 'video', src: `/${p}`, poster: images[i] ? `/${images[i]}` : undefined, alt: `Video ${i + 1}` }));

const fileContents = `/** AUTO-GENERATED by scripts/generate-perspective-media.js */\n` +
  `export const perspectiveMedia = ${JSON.stringify(items, null, 2)};\n\nexport default perspectiveMedia;\n`;

fs.writeFileSync(outFile, fileContents, 'utf8');
console.log('Wrote', outFile);
console.log('Images found:', images.length, 'Videos found:', videos.length);
